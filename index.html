<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zeus Mode — Режим Зевса</title>
<!-- Favicon: inlined SVG for reliability -->
<link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M11%2021L12.722%2014.885L18%2010L12%203V9.115L10.278%2015.115L6%2019L11%2021Z%22%20fill%3D%22%23FFD700%22%2F%3E%3C%2Fsvg%3E" type="image/svg+xml">
<!-- Apple Touch Icon for iOS home screen -->
<link rel="apple-touch-icon" href="https://placehold.co/180x180/FFD700/000000?text=⚡️">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  /* === Colors and Font === */
  :root {
    --bg1: #000000;
    --bg2: #000000;
    --accent: #FFD700; /* Richer gold */
    --card: #111111;
    --card-border: rgba(255, 255, 255, 0.1);
    --muted: #CCCCCC;
    --white: #FFFFFF;
    --btn-primary-bg: linear-gradient(90deg, #333333, var(--accent));
  }
  * {
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
  }

  /* === Base Layout === */
  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg1);
    color: var(--white);
    min-height: 100vh;
  }
  .app {
    max-width: 900px;
    margin: 0 auto;
    padding: 24px 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 100vh;
  }
  .card {
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.04), transparent);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5);
    width: 100%;
  }
  header {
    display: flex;
    gap: 16px;
    align-items: center;
    justify-content: center;
  }
  .logo {
    width: 72px;
    height: 72px;
    border-radius: 12px;
    background: #000000;
    border: 1px solid var(--card-border);
    box-shadow: inset 0 0 10px rgba(255, 215, 0, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    color: var(--accent);
    font-size: 36px;
  }
  /* Unified Typography Rules */
  h1, h2, h3 {
    font-size: 24px;
    font-weight: 800;
    margin: 0 0 8px 0;
  }
  p, li {
    font-size: 16px;
    color: var(--muted);
    margin-top: 8px;
  }
  p.lead, .small {
    font-size: 14px;
    color: var(--muted);
    margin-top: 8px;
  }

  /* === Modals and Effects === */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .modal-overlay.open {
    opacity: 1;
    visibility: visible;
  }
  .modal-content {
    background: var(--card);
    padding: 32px;
    border-radius: 12px;
    border: 1px solid var(--card-border);
    max-width: 400px;
    text-align: center;
    transform: translateY(-20px);
    transition: transform 0.3s ease;
  }
  .modal-overlay.open .modal-content {
    transform: translateY(0);
  }
  #flash {
    position: fixed;
    inset: 0;
    background: #fff;
    opacity: 0;
    pointer-events: none;
    z-index: 9999;
  }
  .flash-on {
    animation: flashAnim .55s ease-out forwards;
  }
  @keyframes flashAnim {
    0% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }

  /* === Screen and Component Styles === */
  .screen {
    display: none;
    padding: 18px;
    flex-direction: column;
    align-items: center;
    width: 100%;
    text-align: center;
  }
  .screen.active {
    display: flex;
  }
  .centered-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    margin-top: 24px;
    width: 100%;
  }
  button {
    border: 0;
    padding: 24px 24px; /* Уменьшенная, но все еще увеличенная высота */
    border-radius: 12px;
    cursor: pointer;
    font-weight: 700;
    font-size: 16px; /* Unified font size for all buttons */
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    width: 100%;
  }
  button:active {
    transform: scale(0.98);
  }
  .btn-primary {
    background: var(--btn-primary-bg);
    color: var(--bg1);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
  }
  .btn-primary:hover {
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
  }
  .steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 12px;
    margin-top: 18px;
    width: 100%;
    max-width: 600px;
    text-align: left;
  }
  .step {
    background: var(--card);
    border: 1px solid var(--card-border);
    padding: 16px;
    border-radius: 12px;
    text-align: left;
    display: flex;
    gap: 12px;
    align-items: center;
  }
  .step input {
    transform: scale(1.3);
    accent-color: var(--accent);
  }
  .controls {
    display: flex;
    gap: 10px;
    margin-top: 18px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .deep {
    margin-top: 18px;
    background: linear-gradient(180deg, rgba(255, 215, 0, 0.06), transparent);
    border: 1px solid rgba(255, 215, 0, 0.1);
    padding: 16px;
    border-radius: 12px;
    color: #fff;
    width: 100%;
    max-width: 600px;
  }
  .stats {
    display: flex;
    gap: 16px;
    margin-top: 24px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 600px;
  }
  .stat {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--card-border);
    padding: 16px;
    border-radius: 12px;
    min-width: 140px;
    text-align: center;
    flex: 1;
  }
  .muted {
    color: var(--muted);
  }
  .link {
    color: var(--accent);
    cursor: pointer;
    text-decoration: underline;
  }
  #rem-interval {
    padding: 10px;
    border-radius: 8px;
    background: transparent;
    color: var(--white);
    border: 1px solid rgba(255,255,255,0.1);
  }
  .timer-display {
    font-size: 64px;
    font-weight: 800;
    text-align: center;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }
  .schedule-content, .training-content, .archetype-content {
    width: 100%;
    max-width: 600px;
    margin-top: 24px;
    text-align: left;
  }
  .schedule-content h3, .training-content h3, .archetype-content h3 {
    font-size: 24px;
    font-weight: 800;
    margin-top: 24px;
  }
  .schedule-content p, .training-content p, .archetype-content p, .schedule-content ul, .training-content ul, .archetype-content ul {
    margin-top: 8px;
  }
  .schedule-content ul, .training-content ul {
    list-style-type: none;
    padding-left: 0;
  }
  .training-content ul {
    list-style-type: disc;
    padding-left: 20px;
  }
  .schedule-content li, .training-content li, .archetype-content li {
    margin-bottom: 4px;
  }
  #response-area {
    margin-top: 18px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    min-height: 100px;
    text-align: left;
    white-space: pre-wrap;
  }
  .response-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--muted);
  }
  .timer-input-group {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    margin-top: 24px;
  }
  .timer-input-group input {
    width: 80px;
    padding: 10px;
    border-radius: 8px;
    background: transparent;
    color: var(--white);
    border: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
  }
  .content-block {
    background: var(--card);
    border: 1px solid var(--card-border);
    padding: 16px;
    border-radius: 12px;
    text-align: left;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .content-block h3 {
    font-size: 24px;
    font-weight: 800;
    margin: 0 0 8px 0;
  }
  .content-block p, .content-block ul {
    color: var(--muted);
    font-size: 16px;
  }
  .interactive-area {
    width: 100%;
    margin-top: 24px;
  }
  .interactive-area textarea {
    width: 100%;
    min-height: 100px;
    padding: 12px;
    border-radius: 8px;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.1);
    resize: none;
    color: var(--white); /* Added this explicit rule */
  }
  .scrollable-content {
    max-height: 60vh; /* Adjust as needed */
    overflow-y: auto;
    padding-right: 12px; /* Add some padding to see the scrollbar */
    -webkit-overflow-scrolling: touch;
    margin-bottom: 24px;
    width: 100%;
  }
</style>
</head>
<body>

<!-- Modals and visual effects -->
<div id="flash"></div>
<div id="modal-overlay" class="modal-overlay">
  <div class="modal-content">
    <h3 id="modal-title" class="text-xl font-bold text-white mb-2"></h3>
    <p id="modal-message" class="text-gray-300 mb-4"></p>
    <button id="modal-close" class="btn-primary">OK</button>
  </div>
</div>

<!-- Main Application Wrapper -->
<main class="app card">
  <header>
    <div class="logo">⚡</div>
    <div>
      <h1>Zeus Mode — Режим Зевса</h1>
      <p class="lead">Триггер → Ритуал → Состояние. Быстро переключайся и закрепляй привычку.</p>
    </div>
  </header>

  <!-- New Screen: Login / Initial View -->
  <section id="screen-login" class="screen active">
    <p class="small">Ты — Зевс. Прими это сейчас.</p>
    <div class="centered-content">
      <button id="btn-enter" class="btn-primary">⚡ Войти в режим Зевса</button>
    </div>
  </section>

  <!-- Screen: Welcome (main app view) -->
  <section id="screen-welcome" class="screen">
    <div class="centered-content">
      <button id="btn-ritual-reminder" class="btn-primary">Микро-ритуал</button>
      <button id="btn-practices" class="btn-primary">Практики</button>
      <button id="btn-schedule" class="btn-primary">Расписание дня</p>
      <button id="btn-training" class="btn-primary">Базовые настройки Зевса</button>
      <button id="btn-archetype" class="btn-primary">Архетип Зевса</button>
      <button id="btn-ai-consult" class="btn-primary">Молниеносный ответ</button>
    </div>
  </section>

  <!-- Screen: Ritual quick reminder -->
  <section id="screen-ritual" class="screen">
    <h2>Микро-ритуал (20–30 сек)</h2>
    <p class="small muted">Сделай быстро. Закрепляет переключение состояния.</p>

    <div class="steps">
      <label class="step"><input type="checkbox" id="s1"> Сел прямо</label>
      <label class="step"><input type="checkbox" id="s2"> Плечи расправил</label>
      <label class="step"><input type="checkbox" id="s3"> Вдох — задержка — мощный выдох</label>
      <label class="step"><input type="checkbox" id="s4"> Взгляд чуть сверху вниз</label>
    </div>

    <div class="centered-content">
      <button id="complete-ritual" class="btn-primary">Завершить ритуал</button>
      <button id="btn-back-ritual" class="btn-primary">Назад</button>
      <button id="reset-steps" class="btn-primary">Сбросить галочки</button>
    </div>
  </section>

  <!-- Screen: Practices -->
  <section id="screen-practices" class="screen">
    <h2>Практики</h2>
    <div class="centered-content" style="gap:12px;">
      <button id="btn-practice-1" class="btn-primary">Дыхание 4–4–4 (2 мин)</button>
      <button id="btn-practice-2" class="btn-primary">Осознанное расслабление (3 мин)</button>
      <button id="btn-practice-3" class="btn-primary">Фокусировка на силе (2 мин)</button>
      <button id="btn-practice-4" class="btn-primary">Молния — энергия (1 мин)</button>
      <button id="btn-back-practices" class="btn-primary">Назад</button>
    </div>
  </section>

  <!-- Screen: Practice Detail with Timer -->
  <section id="screen-practice-detail" class="screen">
    <h2>Название практики</h2>
    <p class="small muted mt-2"></p>
    <div class="centered-content" style="gap: 24px;">
      <div id="practice-timer-display" class="timer-display">00:00</div>
      <div class="controls">
        <button id="btn-start-practice-timer" class="btn-primary">Запустить</button>
        <button id="btn-stop-practice-timer" class="btn-primary" style="display: none;">Завершить</button>
      </div>
    </div>
  </section>

  <!-- Screen: Daily Schedule -->
  <section id="screen-schedule" class="screen">
    <h2>Расписание дня</h2>
    <p class="small muted">Создавай триггеры для переключения состояния.</p>
    <div class="scrollable-content">
      <div class="schedule-content" style="gap: 12px; display: flex; flex-direction: column; width: 100%;">
          <div class="content-block">
            <h3>⚡ Утро «Зевса»</h3>
            <p><b>06:30 —</b> подъём. Ни телефона, ни соцсетей. Только действие.</p>
            <p><b>06:35 —</b> спорт</p>
            <p><b>06:45 —</b> встань перед зеркалом, расправь плечи. Скажи низким голосом 5 фраз:</p>
            <ul class="list-none pl-0">
              <li>1. Так и будет.</li>
              <li>2. Я решил.</li>
              <li>3. Время пришло.</li>
              <li>4. Я хозяин этого.</li>
              <li>5. Всё решено.</li>
            </ul>
            <p><b>07:00 —</b> короткий завтрак: белок + вода. Ешь молча, без новостей.</p>
          </div>

          <div class="content-block">
            <h3>☀️ Днём</h3>
            <p>На работе / в делах:</p>
            <ul class="list-none pl-0">
              <li>• Принимаешь решение → не обсуждаешь бесконечно, говоришь: «Делаем так.»</li>
              <li>• Если спорят → «Я сказал один раз.»</li>
              <li>• Если кто-то заслужил → «Ты сделал верно. Получишь больше.»</li>
              <li>• В переговорах: короткие фразы, паузы, низкий голос. Не спеши, люди будут ждать твоё слово.</li>
            </ul>
          </div>

          <div class="content-block">
            <h3>🌙 Вечер</h3>
            <ul class="list-none pl-0">
              <li><b>20:00 —</b> подведение итогов: выпиши 3 ситуации, где ты говорил как Зевс, и 1, где «слился».</li>
              <li><b>20:30 —</b> награди себя: еда, музыка, отдых — это часть «светлого Зевса».</li>
              <li><b>22:00 —</b> новая запись: «Сегодня я говорил как Зевс. Завтра — ещё сильнее.»</li>
            </ul>
          </div>
      </div>
    </div>
    <div class="centered-content">
      <button id="btn-back-schedule" class="btn-primary">Назад</button>
    </div>
  </section>

  <!-- Screen: Basic Zeus Settings (main screen with clickable blocks) -->
  <section id="screen-training" class="screen">
    <h2>Базовые настройки Зевса</h2>
    <p class="small muted">Основа твоего могущества.</p>
    <div class="scrollable-content">
      <div class="training-content" style="gap: 12px; display: flex; flex-direction: column; width: 100%;">
        <div class="content-block" data-block="body">
          <h3>1. Тело = Мощь ⚡️</h3>
          <p><b>Осанка:</b> прямая спина, расправленные плечи. Выглядишь как правитель, даже если сидишь в кресле. Это мгновенно меняет твоё состояние и отношение окружающих.</p>
          <p><b>Движение:</b> уверенные, размеренные шаги. Никакой суеты. Каждое движение должно нести твёрдость и власть. Не спеши, не суетись. Ты на Олимпе.</p>
        </div>
        <div class="content-block" data-block="speech">
          <h3>2. Речь = Авторитет 🎙</h3>
          <p><b>Голос:</b> низкий, размеренный, глубокий. Он не кричит, а звучит, наполняя собой пространство. Тренируй диафрагмальное дыхание, чтобы голос был мощным.</p>
          <p><b>Паузы:</b> твоя сила — в паузах. Когда ты делаешь паузу, ты заставляешь других ждать твоего слова. Это приём власти. Не заполняй тишину.</p>
        </div>
        <div class="content-block" data-block="character">
          <h3>3. Характер = Власть 💪</h3>
          <p><b>Принятие решений:</b> ты принимаешь решения быстро и без сомнений. Не сомневаешься в том, что ты решил. Твоя воля — закон.</p>
          <p><b>Лидерство:</b> ты не просишь, а говоришь. Не даёшь советы, а ставишь задачи. Люди следуют за тобой не потому, что ты хороший, а потому, что ты — хозяин.</p>
        </div>
        <div class="content-block" data-block="strategy">
          <h3>4. Стратегия = Олимп 🏔</h3>
          <p><b>Масштаб:</b> ты не думаешь о мелочах. Твои мысли — это стратегии. Ты видишь, как твой шаг повлияет на все части системы.</p>
          <p><b>Цель:</b> твоя цель всегда одна — порядок. Ты создаёшь свою систему, в которой нет хаоса. Все процессы, люди, ресурсы служат одной цели — твоей.</p>
        </div>
      </div>
    </div>
    <div class="centered-content" style="margin-top: 24px;">
      <button id="btn-back-training" class="btn-primary">Назад</button>
    </div>
  </section>

  <!-- New Screen: Archetype of Zeus -->
  <section id="screen-archetype" class="screen">
    <h2>Архетип Зевса</h2>
    <p class="small muted">Система двух полюсов: светлый и теневой. У него нет морали — есть порядок, который он устанавливает.</p>
    <div class="scrollable-content">
      <div class="archetype-content" style="gap: 12px; display: flex; flex-direction: column; width: 100%;">
        <div class="content-block">
          <h3>☀️ Светлая сторона Зевса</h3>
          <p><b>Качества:</b> защита, щедрость, создание структуры, лидерство, умение решать конфликты.</p>
          <p><b>Как применять:</b> быть опорой для семьи, устанавливать правила для команды, вести друзей вперёд.</p>
        </div>
        <div class="content-block">
          <h3>🌑 Теневая сторона Зевса</h3>
          <p><b>Качества:</b> жесткость, гнев, контроль, манипуляция благами, уважение через силу.</p>
          <p><b>Как применять:</b> давить авторитетом в переговорах, отрезать слабые звенья в бизнесе, пресекать хаос.</p>
        </div>
        <div class="content-block">
          <h3>⚡ Баланс (ключевой принцип)</h3>
          <p>Зевс = и солнце, и молния. Настоящая сила в умении давать и забирать по справедливости твоего порядка.</p>
        </div>
      </div>
    </div>
    <div class="centered-content" style="margin-top: 24px;">
      <button id="btn-back-archetype" class="btn-primary">Назад</button>
    </div>
  </section>

  <!-- Screen: AI Consultation -->
  <section id="screen-ai-consult" class="screen">
    <h2>Молниеносный ответ</h2>
    <p class="small muted">Спроси ИИ, как бы поступил Зевс.</p>
    <div class="centered-content">
      <textarea id="ai-question" class="w-full h-32 p-4 bg-transparent border border-gray-700 rounded-lg focus:outline-none focus:border-yellow-400" placeholder="Например: Как Зевс реагирует на попрошайку? Или Как Зевс ведет машину?"></textarea>
      <button id="btn-ask-ai" class="btn-primary">⚡ Спросить</button>
      <div id="response-area"></div>
      <button id="btn-back-ai-consult" class="btn-primary">Назад</button>
    </div>
  </section>

<script>
  // === UI Helpers ===
  function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function showModal(title, message) {
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-message').textContent = message;
    document.getElementById('modal-overlay').classList.add('open');
  }

  document.getElementById('modal-close').addEventListener('click', () => {
    document.getElementById('modal-overlay').classList.remove('open');
  });

  // Visual flash effect
  function flashEffect() {
    const f = document.getElementById('flash');
    f.classList.remove('flash-on');
    void f.offsetWidth; // Trigger reflow
    f.classList.add('flash-on');
  }

  // Stops any running timer and returns to the welcome screen
  function stopAllTimers() {
    clearInterval(practiceTimerInterval);
  }

  // Sets up the practice screen with the correct details
  function setupPracticeScreen(title, description, duration) {
    document.getElementById('practice-title').textContent = title;
    document.getElementById('practice-description').textContent = description;
    document.getElementById('practice-timer-display').textContent = `${String(Math.floor(duration / 60)).padStart(2, '0')}:${String(duration % 60).padStart(2, '0')}`;
    currentPracticeDuration = duration;

    // Show start button and hide stop button initially
    document.getElementById('btn-start-practice-timer').style.display = 'block';
    document.getElementById('btn-stop-practice-timer').style.display = 'none';

    show('screen-practice-detail');
    flashEffect();
  }
  
  // Starts the countdown timer for practices
  let practiceTimerInterval = null;
  let currentPracticeDuration = 0;

  function startPracticeTimer(durationInSeconds) {
    let timerDisplay = document.getElementById('practice-timer-display');
    let timeLeft = durationInSeconds;

    // Hide start button and show stop button
    document.getElementById('btn-start-practice-timer').style.display = 'none';
    document.getElementById('btn-stop-practice-timer').style.display = 'block';

    function updateDisplay() {
      let minutes = Math.floor(timeLeft / 60);
      let seconds = timeLeft % 60;
      timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    updateDisplay();
    clearInterval(practiceTimerInterval);
    practiceTimerInterval = setInterval(() => {
      timeLeft--;
      if (timeLeft >= 0) {
        updateDisplay();
      } else {
        stopAllTimers();
        showModal('Практика завершена', 'Ты справился. Теперь ты стал ещё могущественнее.');
        show('screen-welcome');
      }
    }, 1000);
  }


  // === Screen Navigation and Event Listeners ===
  document.getElementById('btn-enter').addEventListener('click', () => {
    flashEffect();
    show('screen-welcome');
  });

  document.getElementById('btn-ritual-reminder').addEventListener('click', () => show('screen-ritual'));
  document.getElementById('btn-practices').addEventListener('click', () => show('screen-practices'));
  document.getElementById('btn-schedule').addEventListener('click', () => show('screen-schedule'));
  document.getElementById('btn-training').addEventListener('click', () => show('screen-training'));
  document.getElementById('btn-archetype').addEventListener('click', () => show('screen-archetype'));
  document.getElementById('btn-ai-consult').addEventListener('click', () => show('screen-ai-consult'));

  document.getElementById('btn-back-ritual').addEventListener('click', () => show('screen-welcome'));
  document.getElementById('btn-back-practices').addEventListener('click', () => show('screen-welcome'));
  document.getElementById('btn-back-schedule').addEventListener('click', () => show('screen-welcome'));
  document.getElementById('btn-back-training').addEventListener('click', () => show('screen-welcome'));
  document.getElementById('btn-back-archetype').addEventListener('click', () => show('screen-welcome'));
  document.getElementById('btn-back-ai-consult').addEventListener('click', () => show('screen-welcome'));

  // Ritual steps controls
  document.getElementById('reset-steps').addEventListener('click', () => {
    ['s1', 's2', 's3', 's4'].forEach(id => document.getElementById(id).checked = false);
  });

  document.getElementById('complete-ritual').addEventListener('click', () => {
    const done = ['s1', 's2', 's3', 's4'].map(id => document.getElementById(id).checked).filter(Boolean).length;
    if (done < 2) {
      showModal('Недостаточно шагов', 'Сделай минимум 2 шага ритуала. Быстро и жёстко.');
      return;
    }
    flashEffect();
    showModal('Ритуал зафиксирован', 'Ваша активация успешно завершена.');
    show('screen-welcome');
  });

  // Practice buttons with new logic
  document.getElementById('btn-practice-1').addEventListener('click', () => {
    setupPracticeScreen('Дыхание 4–4–4', 'Сделай вдох на 4 счёта, задержи дыхание на 4 счёта, и выдохни на 4 счёта. Повтори 10 раз.', 120);
  });
  document.getElementById('btn-practice-2').addEventListener('click', () => {
    setupPracticeScreen('Осознанное расслабление', 'Сядь или ляг, расслабь каждую часть тела по очереди. Начни с пальцев ног и поднимайся выше.', 180);
  });
  document.getElementById('btn-practice-3').addEventListener('click', () => {
    setupPracticeScreen('Фокусировка на силе', 'Выбери один объект и смотри на него, представляя, как твоя внутренняя сила растёт. Не отвлекайся.', 120);
  });
  document.getElementById('btn-practice-4').addEventListener('click', () => {
    setupPracticeScreen('Молния — энергия', 'Стоя, вытяни руки вверх, сжимая кулаки. Представь, как энергия молнии входит в твоё тело. Медленно опускай руки, ощущая, как сила наполняет тебя.', 60);
  });

  document.getElementById('btn-start-practice-timer').addEventListener('click', () => {
    if (currentPracticeDuration > 0) {
      startPracticeTimer(currentPracticeDuration);
    }
  });

  document.getElementById('btn-stop-practice-timer').addEventListener('click', () => {
    stopAllTimers();
    showModal('Практика прервана', 'Практика остановлена. Возвращайся, когда будешь готов.');
    show('screen-welcome');
  });

  // === AI Consultation Logic ===
  document.getElementById('btn-ask-ai').addEventListener('click', async () => {
    const question = document.getElementById('ai-question').value.trim();
    const responseArea = document.getElementById('response-area');
    const askButton = document.getElementById('btn-ask-ai');

    if (!question) {
      showModal('Вопрос не задан', 'Введите ваш вопрос, чтобы получить ответ Зевса.');
      return;
    }

    // Disable button and show loading state
    askButton.disabled = true;
    askButton.textContent = 'Думаю...';
    responseArea.innerHTML = '<div class="response-loading">Молнии собираются...</div>';

    // Construct the LLM payload
    const systemPrompt = "Ты — не просто персонаж, ты — воплощение принципов силы, порядка и стратегического мышления. Твоя задача — давать конкретные, применимые инструкции, которые помогают достичь состояния полного контроля в реальной жизни. Избегай пафосных, абстрактных и метафоричных фраз. Сосредоточься на физических действиях (поза, осанка, взгляд, хват), ментальном фокусе (стратегия, осознанность) и контроле среды (атмосфера, звук). Всегда используй нумерованный список (1., 2., 3., ...) для структурирования ответа. Не используй жирный шрифт, курсив, звёздочки или другие символы для выделения текста. Ответы должны быть краткими, прямыми и сильными, как удар молнии. Говори на русском языке.";
    const userQuery = `Как бы ты, как Зевс, поступил в ситуации: "${question}"}"?`;

    const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: {
            parts: [{ text: systemPrompt }]
        },
    };

    let retries = 0;
    const maxRetries = 3;
    const initialDelay = 1000;

    const fetchWithRetry = async (url, options) => {
        try {
            const response = await fetch(url, options);
            if (response.status === 429) {
                if (retries < maxRetries) {
                    retries++;
                    const delay = initialDelay * Math.pow(2, retries - 1);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchWithRetry(url, options);
                } else {
                    throw new Error('Too many requests. Please try again later.');
                }
            }
            if (!response.ok) {
                throw new Error(`API call failed with status: ${response.status}`);
            }
            return response;
        } catch (error) {
            console.error('Fetch error:', error);
            throw error;
        }
    };

    try {
        const response = await fetchWithRetry('/api/zeus-mode', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        const text = result?.text || "Молнии сейчас заняты на Олимпе. Попробуй позже.";
        responseArea.textContent = text;
    } catch (error) {
        responseArea.textContent = `Ошибка: ${error.message}`;
        console.error('Failed to get AI response:', error);
    } finally {
        askButton.disabled = false;
        askButton.textContent = '⚡ Спросить';
    }
  });

  // === Dynamic Theme Logic ===
  function setTimeBasedTheme() {
    const root = document.documentElement;
    const now = new Date();
    const hour = now.getHours();

    if (hour >= 6 && hour < 18) {
      // Day Mode (6:00 - 17:59)
      root.style.setProperty('--bg1', '#f0f0f0');
      root.style.setProperty('--bg2', '#f0f0f0');
      root.style.setProperty('--card', '#f8f8f8');
      root.style.setProperty('--card-border', 'rgba(0, 0, 0, 0.1)');
      root.style.setProperty('--muted', '#666666');
      root.style.setProperty('--white', '#000000');
      root.style.setProperty('--accent', '#B8860B');
      root.style.setProperty('--btn-primary-bg', 'linear-gradient(90deg, #666666, #B8860B)');
    } else {
      // Night Mode (18:00 - 5:59)
      root.style.setProperty('--bg1', '#000000');
      root.style.setProperty('--bg2', '#000000');
      root.style.setProperty('--card', '#111111');
      root.style.setProperty('--card-border', 'rgba(255, 255, 255, 0.1)');
      root.style.setProperty('--muted', '#CCCCCC');
      root.style.setProperty('--white', '#FFFFFF');
      root.style.setProperty('--accent', '#FFD700');
      root.style.setProperty('--btn-primary-bg', 'linear-gradient(90deg, #333333, var(--accent))');
    }
    // Update elements that rely on colors
    document.querySelector('.logo').style.backgroundColor = getComputedStyle(root).getPropertyValue('--card');
    document.querySelector('.logo').style.borderColor = getComputedStyle(root).getPropertyValue('--card-border');
    document.querySelector('.logo').style.boxShadow = `inset 0 0 10px ${getComputedStyle(root).getPropertyValue('--accent')}20`;
  }

  // Set initial theme on page load
  setTimeBasedTheme();

  // Update theme every minute to catch hour changes
  setInterval(setTimeBasedTheme, 60000);
</script>

</body>
</html>
